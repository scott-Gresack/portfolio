<!DOCTYPE html>
<!--
  üì± Mobile Tag Spec Builder
  Author: Scott Gresack
  URL: https://scott-gresack.github.io/portfolio/mobile_updates

  This interactive tool is designed for generating Adobe Mobile SDK payloads.
  Features:
  - Supports trackAction, trackState, and Edge.sendEvent calls.
  - Dynamically builds payloads with key-value context and XDM identityMap.
  - Generates native code snippets for Swift, Kotlin, and React Native.
  - Supports Adobe Edge datastream override and identity stitching via identityMap.
  - Live payload preview and session-local storage of input.

  Best used for QA, testing journeys, and validating analytics setup across environments.

  Adobe Recommendation:
  When using identityMap, mark person-based identifiers (e.g., CRMID, email) as "primary".
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#1E40AF" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="https://scott-gresack.github.io/portfolio/icons/icon-192x192.png">

  <title>üì± Mobile Tag Spec Builder | Scott Gresack</title>
  <meta name="description" content="Scott Gresack is a Martech Engineer and AEP Specialist with expertise in Adobe Experience Platform, Tealium iQ, and Customer Data Platforms. Explore real-world implementations for identity stitching, tag architecture, and XDM governance.">
  <meta name="keywords" content="Martech Engineer, Adobe Experience Platform, AEP, CDP, Tealium iQ, Customer Data Platform, Tag Management, Identity Resolution, XDM Schema, Adobe Analytics, Adobe Web SDK, Adobe Target, Journey Orchestration, Real-Time Personalization, Martech Portfolio, Martech Jobs, Adobe Developer">
  <meta name="author" content="Scott Gresack" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://scott-gresack.github.io/portfolio/mobile_updates" />
  <meta property="og:title" content="Scott Gresack | Martech Engineer | Adobe AEP & CDP Specialist">
  <meta property="og:description" content="Explore Scott Gresack‚Äôs Martech portfolio ‚Äî featuring advanced implementations in Adobe Experience Platform, tag governance, real-time identity stitching, and customer data strategy.">
  <meta property="og:image" content="https://yourdomain.com/path/to/social-preview-image.png">
  <meta property="og:url" content="https://yourdomain.com">
  <meta property="og:type" content="website">
  <meta name="twitter:title" content="Scott Gresack | Martech Engineer | AEP & CDP Expert">
  <meta name="twitter:description" content="Portfolio featuring Adobe Experience Platform, real-time data collection, Tealium iQ, identity resolution, and scalable tracking architecture.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://yourdomain.com/path/to/social-preview-image.png">

  <script defer src="https://www.googletagmanager.com/gtag/js?id=GT-MQBSZT8H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'GT-MQBSZT8H');
  </script>

  <script defer type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "Mobile Tag Spec Builder",
    "applicationCategory": "DeveloperTool",
    "operatingSystem": "Web",
    "url": "https://scott-gresack.github.io/portfolio/mobile_updates",
    "author": {
      "@type": "Person",
      "name": "Scott Gresack"
    }
  }
  </script>

  <script>
    !function(t,e){
      var o,n,p,r;
      if (!e.__SV) {
        window.posthog = e;
        e._i = [];
        e.init = function(i,s,a){
          function g(t,e){
            var o=e.split(".");
            2==o.length && (t=t[o[0]], e=o[1]);
            t[e] = function(){ t.push([e].concat(Array.prototype.slice.call(arguments,0))) };
          }
          p = t.createElement("script");
          p.type = "text/javascript";
          p.async = !0;
          p.src = s.api_host + "/static/array.js";
          r = t.getElementsByTagName("script")[0];
          r.parentNode.insertBefore(p,r);
          var u = e;
          void 0 !== a ? u = e[a] = [] : a = "posthog";
          u.people = u.people || [];
          u.toString = function(t){
            var e = "posthog";
            return "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e;
          };
          u.people.toString = function(){ return u.toString(1) + ".people (stub)" };
          o = "init capture identify".split(" ");
          for (n = 0; n < o.length; n++) g(u, o[n]);
          e._i.push([i, s, a]);
        };
        e.__SV = 1;
      }
    }(document, window.posthog || []);
    posthog.init('phc_poY0XlVu6WBmOsIKW4OwRT60oDXKjJrMhPz1tqhvK6U', {
      api_host: 'https://us.i.posthog.com',
      autocapture: true,
      capture_pageview: true
    });
  </script>


  <script defer>
    (function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y)})(window,document,"clarity","script","pmp4efispy");
  </script>

  <script defer>
    (function(window,document,dataLayerName,id){
      window[dataLayerName]=window[dataLayerName]||[],window[dataLayerName].push({start:(new Date).getTime(),event:"stg.start"});
      var scripts=document.getElementsByTagName('script')[0],tags=document.createElement('script');
      tags.async=!0;tags.src="https://scott-gresack.containers.piwik.pro/40c8a729-ebc6-4dfe-98be-6617064e43a9.js";
      scripts.parentNode.insertBefore(tags,scripts);
    })(window,document,'dataLayer','40c8a729-ebc6-4dfe-98be-6617064e43a9');
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <style>
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeInUp { animation: fadeInUp 0.6s ease-out forwards; }
  </style>
</head>

<body class="bg-white text-gray-900 font-sans antialiased leading-relaxed tracking-wide">

  <header class="bg-white shadow sticky top-0 z-50 text-gray-900">
    <nav class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center text-sm font-medium">
      <div class="font-semibold">Scott Gresack</div>
      <div class="relative group">
        <button class="hover:text-blue-600 transition flex items-center gap-1">
          Tools ‚ñº
        </button>
        <div class="absolute hidden group-hover:block bg-white border border-gray-200 mt-2 rounded-md shadow-lg text-sm z-50 min-w-[200px]">
          <a href="https://scott-gresack.github.io/portfolio/tool2.html?utm_source=portfolio&utm_medium=internal&utm_campaign=dropdown&utm_term=alloy" class="block px-4 py-2 hover:bg-blue-50">Alloy Tool</a>
          <a href="https://scott-gresack.github.io/portfolio/xdm_comparator?utm_source=portfolio&utm_medium=internal&utm_campaign=dropdown&utm_term=xdm" class="block px-4 py-2 hover:bg-blue-50">XDM Comparator</a>
          <a href="https://scott-gresack.github.io/portfolio/tag_generator?utm_source=portfolio&utm_medium=internal&utm_campaign=dropdown&utm_term=tag" class="block px-4 py-2 hover:bg-blue-50">Tag Spec Tool</a>
          <a href="https://scott-gresack.github.io/portfolio/mobile_updates?utm_source=portfolio&utm_medium=internal&utm_campaign=dropdown&utm_term=mobile" class="block px-4 py-2 hover:bg-blue-50">Mobile Tag Builder</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="flex flex-col items-center justify-center min-h-screen px-4 pb-24 animate-fadeInUp">
    <div class="w-full max-w-3xl bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-200">
      <div class="bg-gradient-to-r from-blue-700 via-blue-600 to-blue-500 text-white p-8 rounded-t-3xl">
        <h1 class="text-4xl font-extrabold tracking-tight">üì± Mobile Tag Spec Builder</h1>
        <p class="mt-2 text-blue-100">Dynamically build <code>trackAction</code>, <code>trackState</code>, and Edge events with XDM preview.</p>
      </div>
      <div class="p-8 space-y-8">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-900 space-y-2">
          <h2 class="text-base font-semibold text-blue-800">üß≠ How to Use This Tool (End-to-End)</h2>
          <ul class="list-disc list-inside space-y-1">
            <li>Select a tracking type: <code class="bg-blue-100 px-1 rounded">trackAction</code>, <code class="bg-blue-100 px-1 rounded">trackState</code>, or <code class="bg-blue-100 px-1 rounded">Edge.sendEvent</code>.</li>
            <li>Add any key-value pairs relevant to your mobile event context (e.g. screen name, feature flags).</li>
            <li>Use the XDM tab to add Adobe Experience Platform fields or schema-specific values.</li>
            <li>Preview the generated payload ‚Äî it will reflect your session and user context.</li>
            <li>Copy the payload for use in your native app (Swift or Kotlin) or for QA validation.</li>
            <li>Session data and PostHog logs help you validate behavior against backend or CJA.</li>
            <li>Choose your SDK style (e.g., AEPEdgeBridge vs MobileCore) to see native API formats for iOS, Android, and React Native.</li>
          </ul>
        </div>
        <div id="root"></div>
        <noscript class="text-center text-red-500 text-sm mt-4">Please enable JavaScript to use this tool.</noscript>
      </div>
      <footer class="bg-gray-50 text-gray-600 p-4 text-center rounded-b-3xl border-t text-sm">
        Built with ‚ù§Ô∏è by <a href="https://scott-gresack.github.io/portfolio/" class="text-blue-600 hover:underline">Scott Gresack</a>
      </footer>
    </div>
  </main>

<script>
  const { createApp, ref, computed, onMounted, watch } = Vue;

  createApp({
    setup() {
      const eventType = ref('trackAction');
      const keyValues = ref([{ category: 'contextData', key: '', value: '' }]);
      const overrideDatastream = ref(false);
      const datastreamId = ref('');
      const sendIdentityMap = ref(false);
      const identityNamespace = ref('email');
      const identityId = ref('user@example.com');
      const apiStyle = ref('bridge'); // 'bridge', 'core', 'legacy'

      const copied = ref('');

      const addKeyValue = () => keyValues.value.push({ category: 'contextData', key: '', value: '' });

      const jsonPayload = computed(() => {
        // Build up payload based on categories
        const contextData = {};
        let actionName = '', stateName = '', products = '';
        keyValues.value.forEach(({ category, key, value }) => {
          if (category === 'actionName') {
            actionName = value;
          } else if (category === 'stateName') {
            stateName = value;
          } else if (category === 'products') {
            products = value;
          } else if (category === 'contextData' && key) {
            contextData[key] = value;
          }
        });

        if (eventType.value === 'trackAction' || eventType.value === 'trackState') {
          return {
            data: {
              __adobe: {
                analytics: {
                  linkName: eventType.value === 'trackAction' ? actionName : stateName,
                  linkType: eventType.value === 'trackAction' ? 'other' : '',
                  cp: 'foreground',
                  products,
                  contextData: {
                    "a.AppID": "myApp 1.0 (1)",
                    ...contextData
                  }
                }
              }
            }
          };
        }

        // For sendEvent/Edge payloads, just flatten contextData
        const base = {};
        Object.assign(base, contextData);
        if (sendIdentityMap.value && identityNamespace.value && identityId.value) {
          base["xdm"] = base["xdm"] || {};
          base["xdm"]["identityMap"] = {
            [identityNamespace.value]: [
              {
                id: identityId.value,
                authenticatedState: "authenticated",
                primary: true
              }
            ]
          };
        }
        return base;
      });

      const swiftCode = computed(() => {
        const payload = JSON.stringify(jsonPayload.value, null, 2);
        if (apiStyle.value === 'bridge') {
          if (eventType.value === 'sendEvent') {
            return `let xdmData = jsonPayload["xdm"] as? [String: Any] ?? [:]
let dataPayload = jsonPayload["data"] as? [String: Any]
let event = ExperienceEvent(xdm: xdmData, data: dataPayload,
                           datastreamIdOverride: overrideDatastream.value ? datastreamId.value : nil,
                           datastreamConfigOverride: overrideDatastream.value && datastreamId.value ? ["datastreamId": datastreamId.value] : nil)
Edge.sendEvent(event: event)
`;
          } else {
            let call = `AEPEdgeBridge.sendEvent(with: ${payload}`;
            if (overrideDatastream.value && datastreamId.value) {
              call += `, datastreamId: "${datastreamId.value}"`;
            }
            if (sendIdentityMap.value) {
              call += `, identityMap: identityMap`; // assume user creates identityMap object earlier
            }
            call += `)`;
            return call;
          }
        } else {
          return `ACPExtension.${eventType.value}(withData: ${payload})`;
        }
      });

      const kotlinCode = computed(() => {
        const payload = JSON.stringify(jsonPayload.value, null, 2);
        if (apiStyle.value === 'bridge') {
          if (eventType.value === 'sendEvent') {
            return `val xdmData = jsonPayload["xdm"] as? Map<String, Any> ?: emptyMap()
val dataPayload = jsonPayload["data"] as? Map<String, Any>
val event = ExperienceEvent.Builder()
    .setXdmSchema(xdmData)
    .apply { dataPayload?.let { setData(it) } }
    .apply { if (overrideDatastream.value && datastreamId.value.isNotEmpty()) setDatastreamConfigOverride(mapOf("datastreamId" to datastreamId.value)) }
    .build()
Edge.sendEvent(event)
`;
          } else {
            let call = `AEPEdgeBridge.sendEvent(mapOf(\n${payload}\n)`;
            if (overrideDatastream.value && datastreamId.value) {
              call += `, datastreamId = "${datastreamId.value}"`;
            }
            if (sendIdentityMap.value) {
              call += `, identityMap = identityMap)`; 
            } else {
              call += `)`;
            }
            return call;
          }
        } else {
          return `MobileCore.${eventType.value}(mapOf(\n${payload}\n))`;
        }
      });

      const reactNativeCode = computed(() => {
        const payload = JSON.stringify(jsonPayload.value, null, 2);
        if (apiStyle.value === 'bridge') {
          if (eventType.value === 'sendEvent') {
            return `const { xdm, data } = jsonPayload;
const event = {
  xdm: xdm || {},
  data: data || undefined,
  datastreamIdOverride: overrideDatastream.value ? datastreamId.value : undefined,
  datastreamConfigOverride: overrideDatastream.value && datastreamId.value ? { datastreamId: datastreamId.value } : undefined
};
Edge.sendEvent(event);
`;
          } else {
            let call = `AEPEdgeBridge.sendEvent(${payload}`;
            const options = [];
            if (overrideDatastream.value && datastreamId.value) {
              options.push(`datastreamId: "${datastreamId.value}"`);
            }
            if (sendIdentityMap.value) {
              options.push(`identityMap: identityMap`);
            }
            if (options.length) {
              call += `, { ${options.join(', ')} }`;
            }
            call += `);`;
            return call;
          }
        } else {
          return `ACPExtension.${eventType.value}(${payload});`;
        }
      });

      const overridesCode = computed(() => {
        const parts = [];
        if (overrideDatastream.value && datastreamId.value) {
          parts.push(`datastreamId: "${datastreamId.value}"`);
        }
        if (sendIdentityMap.value && identityNamespace.value && identityId.value) {
          parts.push(`identityMap: { "${identityNamespace.value}": [{ id: "${identityId.value}", authenticatedState: "ambiguous", primary: true }] }`);
        }
        return parts.length ? `{ ${parts.join(', ')} }` : 'None';
      });

      const copyToClipboard = (content, label) => {
        navigator.clipboard.writeText(content).then(() => {
          copied.value = `‚úÖ Copied ${label}`;
          setTimeout(() => copied.value = '', 2000);
        });
      };

      onMounted(() => {
        const saved = localStorage.getItem('mobilePayload');
        if (saved) keyValues.value = JSON.parse(saved);
      });

      watch(jsonPayload, (val) => {
        localStorage.setItem('mobilePayload', JSON.stringify(keyValues.value));
      });

      // Contextual Help modal logic
      const showHelpModal = ref(false);
      const helpSection = ref('');
      function openHelp(section) {
        helpSection.value = section;
        showHelpModal.value = true;
      }
      const helpContent = computed(() => {
        switch (helpSection.value) {
          case 'eventType': return {
            title: 'Event Type',
            guide: `Choose which method to simulate. "trackAction" and "trackState" are standard mobile analytics events. Use "Edge.sendEvent" for XDM calls.`,
            sample: eventType.value === 'trackAction'
              ? { code: `AEPEdgeBridge.trackAction("add_to_cart", data: { "productId": "123" })`, payload: `{ "productId": "123" }` }
              : eventType.value === 'trackState'
              ? { code: `AEPEdgeBridge.trackState("Product Detail", data: { "screen": "detail" })`, payload: `{ "screen": "detail" }` }
              : { code: `AEPEdgeBridge.sendEvent(with: { "xdm": { "eventType": "commerce.purchases" } })`, payload: `{ "xdm": { "eventType": "commerce.purchases" } }` }
          };
          case 'apiStyle': return {
            title: 'SDK API Style',
            guide: `Select which SDK integration method matches your mobile app. AEPEdgeBridge is recommended for modern Swift/Kotlin apps; ACPExtension/MobileCore for legacy apps.`,
            sample: { code: `AEPEdgeBridge.sendEvent(...)` }
          };
          case 'context': return {
            title: 'Context Key-Value Pairs',
            guide: `Add any keys and values representing your event context‚Äîscreen names, feature flags, or any business-relevant data. These are sent to Adobe as the payload.`,
            sample: { payload: `{ "screen": "Home", "featureFlag": true }` }
          };
          case 'overrides': return {
            title: 'Adobe Edge Overrides',
            guide: `Optionally override the Datastream ID (to send to a different Adobe config) or send an identityMap (for identity stitching, login flows, etc.). Useful for QA, sandboxes, or testing user journeys.`,
            sample: { code: `datastreamId: "my-qa-stream", identityMap: { "email": [{ id: "user@example.com" }] }` }
          };
          default: return { title: '', guide: '', sample: {} };
        }
      });

      return {
        eventType,
        keyValues,
        overrideDatastream,
        datastreamId,
        sendIdentityMap,
        identityNamespace,
        identityId,
        apiStyle,
        jsonPayload,
        addKeyValue,
        swiftCode,
        kotlinCode,
        reactNativeCode,
        overridesCode,
        copyToClipboard,
        copied,
        showHelpModal,
        helpSection,
        openHelp,
        helpContent
      };
    },
    template: `
      <div class="space-y-6">
        <!-- Legend for live help -->
        <div class="mb-4 text-blue-800 text-sm flex items-center">
          <span class="inline-block bg-blue-100 text-blue-700 rounded-full px-2 py-0.5 mr-2">?</span>
          <span>Click any <span class="font-bold">question mark</span> icon for live help and code samples for that section.</span>
        </div>

        <!-- Event type dropdown -->
        <div>
          <label class="block font-semibold flex items-center">
            Event Type
            <button @click="openHelp('eventType')" title="Help for Event Type" class="ml-2 rounded-full bg-blue-100 p-1 text-blue-700 hover:bg-blue-200" aria-label="Help for Event Type">?</button>
          </label>
          <select v-model="eventType" class="w-full border rounded p-2 mt-2">
            <option value="trackAction">trackAction</option>
            <option value="trackState">trackState</option>
            <option value="sendEvent">Edge.sendEvent</option>
          </select>
          <p class="text-xs text-gray-500 mt-1">
            Choose which method you want to simulate. <code>trackAction</code> and <code>trackState</code> are standard mobile analytics events. Use <code>sendEvent</code> for Adobe Edge Network calls with XDM.
          </p>
        </div>

        <div class="space-y-2">
          <label class="block font-semibold flex items-center">
            üìö SDK API Style
            <button @click="openHelp('apiStyle')" title="Help for SDK API Style" class="ml-2 rounded-full bg-blue-100 p-1 text-blue-700 hover:bg-blue-200" aria-label="Help for SDK API Style">?</button>
          </label>
          <select v-model="apiStyle" class="w-full border rounded p-2">
            <option value="bridge">AEPEdgeBridge (Modern)</option>
            <option value="core">ACPExtension / MobileCore</option>
            <option value="legacy">Legacy Objective-C Syntax (soon)</option>
          </select>
          <p class="text-xs text-gray-500 mt-1">
            Select the SDK integration method. <code>AEPEdgeBridge</code> reflects v4+ API for Swift and Kotlin. <code>ACPExtension</code> and <code>MobileCore</code> are legacy wrappers. Use this to match your app's SDK version.
          </p>
        </div>

        <!-- Context data -->
        <div>
          <label class="block font-semibold mb-2 flex items-center">
            Context Key-Value Pairs
            <button @click="openHelp('context')" title="Help for Context Key-Value Pairs" class="ml-2 rounded-full bg-blue-100 p-1 text-blue-700 hover:bg-blue-200" aria-label="Help for Context Key-Value Pairs">?</button>
          </label>
          <p class="text-xs text-gray-500 mt-1">
            These represent your event's context data ‚Äî anything from screen names to custom flags. They map directly into the payload structure.
          </p>
          <div v-for="(pair, index) in keyValues" :key="index" class="mt-3 space-y-1">
            <div class="flex space-x-2 items-center">
              <select v-model="pair.category" class="border border-gray-300 rounded-md p-2 w-1/3 focus:ring-blue-500 focus:border-blue-500 transition">
                <!-- For trackAction/trackState -->
                <template v-if="eventType !== 'sendEvent'">
                  <option value="actionName">Action Name</option>
                  <option value="stateName">State Name</option>
                  <option value="products">Products</option>
                  <option value="contextData">Context Data</option>
                </template>
                <!-- For Edge.sendEvent -->
                <template v-else>
                  <option value="eVar">eVar</option>
                  <option value="prop">prop</option>
                  <option value="event">event</option>
                  <option value="contextData">Context Data</option>
                </template>
              </select>
              <template v-if="pair.category === 'contextData'">
                <input v-model="pair.key" placeholder="Key" class="border border-gray-300 rounded-md p-2 w-1/3 focus:ring-blue-500 focus:border-blue-500 transition" />
                <input v-model="pair.value" placeholder="Value" class="border border-gray-300 rounded-md p-2 w-1/3 focus:ring-blue-500 focus:border-blue-500 transition" />
              </template>
              <template v-else>
                <input v-model="pair.value" :placeholder="pair.category === 'products' ? 'Products string' : pair.category === 'actionName' ? 'Action name' : pair.category === 'stateName' ? 'State name' : pair.category"
                       class="border border-gray-300 rounded-md p-2 flex-1 focus:ring-blue-500 focus:border-blue-500 transition" />
              </template>
              <button @click="keyValues.value.splice(index,1)" class="text-red-500 hover:underline">Remove</button>
            </div>
          </div>
          <button @click="addKeyValue" class="text-sm text-blue-600 hover:underline" title="Add a new key-value pair to the context payload">+ Add Pair</button>
        </div>

        <!-- Optional AEP controls -->
        <div v-if="eventType === 'sendEvent'" class="border-t pt-4 space-y-4">
          <label class="font-semibold block flex items-center">
            ‚öôÔ∏è Adobe Edge Overrides
            <button @click="openHelp('overrides')" title="Help for Edge Overrides" class="ml-2 rounded-full bg-blue-100 p-1 text-blue-700 hover:bg-blue-200" aria-label="Help for Edge Overrides">?</button>
          </label>
          <label class="flex items-center space-x-2">
            <input type="checkbox" v-model="overrideDatastream" />
            <span>Override Datastream ID</span>
          </label>
          <input v-if="overrideDatastream" v-model="datastreamId" class="border p-2 rounded w-full" placeholder="Datastream ID" title="Optional: Adobe Datastream ID to override default configuration" />
          <p v-if="overrideDatastream" class="text-xs text-gray-500">
            Use this if you want to route the event to a different Adobe Datastream (e.g. for QA, staging, or a separate sandbox).
          </p>

          <label class="flex items-center space-x-2 mt-2" title="Send XDM identityMap to enable user-level stitching and personalization.">
            <input type="checkbox" v-model="sendIdentityMap" />
            <span>Send identityMap</span>
          </label>
          <div v-if="sendIdentityMap" class="space-y-2">
            <input v-model="identityNamespace" class="border p-2 rounded w-full" placeholder="Namespace (e.g. email, ECID, username)" title="Adobe Identity namespace (e.g., email, ECID, username)" />
            <input v-model="identityId" class="border p-2 rounded w-full" placeholder="ID Value (e.g. user@example.com)" title="Actual ID value to map in identityMap (e.g. user@example.com)" />
            <p class="text-xs text-gray-500">
              The identityMap sends user identifiers like ECID, email, or custom namespaces to Adobe Edge. This enables identity resolution, personalization, and profile stitching across channels.
            </p>
          </div>
        </div>

        <!-- Live JSON output -->
        <div class="bg-gray-50 border p-4 rounded">
          <label class="font-semibold block mb-2 flex items-center">Generated Payload</label>
          <p class="text-xs text-gray-500 mb-2">This JSON represents the payload you will send to the Adobe Edge Network or MobileCore analytics method based on your selection above.</p>
          <pre class="text-sm text-gray-800"><code>{{ JSON.stringify(jsonPayload, null, 2) }}</code></pre>
          <p class="text-xs text-gray-500 mt-1">Overrides: {{ overridesCode }}</p>
        </div>

        <!-- Platform outputs -->
        <div class="grid md:grid-cols-2 gap-4">
          <div class="bg-white border p-4 rounded">
            <div class="flex justify-between items-center mb-1">
              <h3 class="font-semibold">üì± Swift (iOS)</h3>
              <button @click="copyToClipboard(swiftCode, 'Swift')" class="text-blue-600 text-sm hover:underline">Copy</button>
            </div>
            <pre class="text-sm text-gray-800"><code>{{ swiftCode }}</code></pre>
          </div>

          <div class="bg-white border p-4 rounded">
            <div class="flex justify-between items-center mb-1">
              <h3 class="font-semibold">ü§ñ Kotlin / Java (Android)</h3>
              <button @click="copyToClipboard(kotlinCode, 'Kotlin')" class="text-blue-600 text-sm hover:underline">Copy</button>
            </div>
            <pre class="text-sm text-gray-800"><code>{{ kotlinCode }}</code></pre>
          </div>

          <div class="bg-white border p-4 rounded md:col-span-2">
            <div class="flex justify-between items-center mb-1">
              <h3 class="font-semibold">‚öõÔ∏è React Native</h3>
              <button @click="copyToClipboard(reactNativeCode, 'React Native')" class="text-blue-600 text-sm hover:underline">Copy</button>
            </div>
            <pre class="text-sm text-gray-800"><code>{{ reactNativeCode }}</code></pre>
          </div>
        </div>
        <p v-if="copied" class="text-green-600 text-sm">{{ copied }}</p>

        <!-- Contextual Help Modal -->
        <div v-if="showHelpModal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
          <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 relative animate-fadeInUp">
            <button @click="showHelpModal = false" class="absolute top-2 right-2 text-gray-400 hover:text-blue-600 text-2xl">&times;</button>
            <h2 class="text-lg font-bold mb-2">{{ helpContent.title }}</h2>
            <div class="mb-3">
              <p class="text-sm mb-2">{{ helpContent.guide }}</p>
              <div v-if="helpContent.sample && helpContent.sample.code">
                <div class="text-xs text-gray-500 mb-1">Code Sample</div>
                <pre class="bg-gray-100 p-3 rounded text-xs">{{ helpContent.sample.code }}</pre>
              </div>
              <div v-if="helpContent.sample && helpContent.sample.payload">
                <div class="text-xs text-gray-500 mb-1">Sample Payload</div>
                <pre class="bg-gray-100 p-3 rounded text-xs">{{ helpContent.sample.payload }}</pre>
              </div>
            </div>
            <div v-if="helpSection === 'eventType'">
              <div class="text-xs text-blue-800 mt-2">
                <a href="https://medium.com/@ctobin_60705/aep-validation-plugins-with-public-api-support-239637d3b63a" target="_blank" class="underline">Read about validation plugins</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    `
  }).mount('#root');
</script>
</body>
<!-- Syncs GA session ID to PostHog for identity resolution -->
<script>
  (function checkPostHogAndSyncGA(attempts = 0) {
    if (window.posthog && typeof posthog.register === 'function') {
      const gaCookie = document.cookie.split('; ').find(row => row.startsWith('_ga='));
      if (gaCookie) {
        const parts = gaCookie.split('.');
        if (parts.length >= 4) {
          const sessionId = `${parts[2]}.${parts[3]}`;
          console.log('[PostHog] Registered GA session ID:', sessionId);
          posthog.register({ ga_session_id: sessionId });
          posthog.capture('pageview_with_ga_session', { ga_session_id: sessionId });
        }
      }
    } else if (attempts < 10) {
      setTimeout(() => checkPostHogAndSyncGA(attempts + 1), 300);
    } else {
      console.warn('[PostHog] register function not available after retrying.');
    }
  })();
</script>
</html>
